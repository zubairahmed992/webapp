{% extends 'LoveThatFitAdminBundle::base.html.twig' %}
{% block breadcrumb %}
   <li class="active">Products</li>
{% endblock %}



{% block body %}
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.min.js"></script>
<script>
    var page;
 function SearchForm(page){
  if(page==null)
  {page=1;
  } 
var brand=$('#brand').val();

var category = []
   $("#category_select:checked").each(function() {
       category.push($(this).val());
   });

var genders = []
   $("#genders:checked").each(function() {
       genders.push($(this).val());
   });

var target = []
   $("#target:checked").each(function() {
       target.push($(this).val());
   });

$.ajax({
        type:'POST',
        url: $('#url').text(),
        data: {brand: brand, category: category,genders:genders,target:target,page:page},  
        success: function(response) {
       console.log(response);
       $('#all_data').hide();
       $('#all_data_search').empty('');
       $('#all_data_search').show();
       $('#all_data_search').html(response);
       $('#pagination').hide();
       
    }});
    return false;
}

function getTargetCategory(){

var category = []

   $("#category:not(:checked)").each(function() {
       category.push($(this).val());
   });
   
var target = []
   $("#target:checked").each(function() {
       target.push($(this).val());
   });
    if(target!==null){
       $.ajax({
       type:'POST',
       url: $('#url_target').text(),
       data: {target:target},  
       dataType: 'json',
       success: function(ar) {
   
     $('#category_empty').text('');
     if(ar!='null'){
     var playlist=[];
     playlist.push.apply(playlist, ar);
     for(i=0;i<playlist.length;i++){
       
     if(inArray(playlist[i]['id'],category)=="test"){
    
     $('<input />', { type: 'checkbox', id: 'category_select', value: playlist[i]['name'] }).appendTo('#category_empty');
      $('<span />', { 'for': 'playlist','class':'adv_radio', text:playlist[i]['name'] }).appendTo('#category_empty');
    }else{
       $("#category").attr("disabled", true);
       alert(playlist[i]['id']);
       
    }
    }
    
    }else{
 $('#category_empty').text('');
  $('#all_category').show();

}}});
    return false; 


   }
}
function inArray(needle, haystack) {
    var length = haystack.length;
    
    for(var i = 0; i < length; i++) {
        if(haystack[i] == needle) 
        return "test";
    }
   
}
function backToListing(){
    $('#all_data').show();
    $('#all_data_search').hide();
    $('#pagination').show();
}

$(document).ready(function(){

 //SearchForm(1);  // For first time page load default results
                $('.pagination li.active').live('click',function(){
                    var page = $(this).attr('p');
                    SearchForm(page);
                    
                });           
                });
                
 </script>
   
    <span id="admin_product_zip" style="display:none;">{{path('admin_product_detail_zipdownlaod')}}</span>
<div class="p_listing">     
    <h1>Products</h1>
    
    
   
    <div class="btn_wrapper2">
     
        <div id="chart_figures" class="product_chart_figures">
         <div class="facts">
                    <div><span>Total Products:</span>{{rec_count}}</div>
                    <div><span>Female Product:</span>{{femaleProduct}}</div>
                    <div><span>Male Products:</span>{{maleProduct}}</div>
     </div>   
     
    
     </div>
    
     <a href="{{ path('admin_product_stats') }}" class="btn">Product Stats</a>  <a href="{{ path('admin_product_detail_new') }}" class="btn">Add New</a>
     
      </div>
    
    
    
     <div>  
        <button type="button" class="btn btn-danger" data-toggle="collapse" data-target="#demo">
        Search
        </button>
    </div>

    <div id="demo" class="collapse">    
        <div id="adv_srch_wrap"><!--Main wrap -->
    <span id="url" style="display:none;">{{path('admin_product_search_result')}}</span>
    <span id="url_target" style="display:none;">{{path('admin_product_search_category_with_target')}}</span>
          <div class="frm_wrap">
            <div class="adv_srch_hd">Brands</div>           
            <div class="frm_ele">
            <select name="brand" id="brand">
                {% for b in brandList %}
           <option value="{{b.id}}">{{b.name}}</option> 
                {%endfor%}        
            </select>
                 </div>
          </div>
          
          <div class="frm_wrap">
            <div class="adv_srch_hd">Gender</div>           
            <div class="frm_ele">
           {% for g in genders %}
          <span class="adv_radio"><input type="checkbox" name="genders" id="genders" value="{{g|capitalize}}" ></span>
          <span class="adv_gdr">{{g|capitalize}}</span>
          {%endfor%}
           </div>
           </div>         
          
          <div class="frm_wrap">
            <div class="adv_srch_hd">Clothing Type</div>           
            <div class="frm_ele">
           {% for t in target %}
         <span class="adv_radio">
                <input type="checkbox" name="target" id="target" value="{{t|capitalize }}" onclick="getTargetCategory()">
              </span>
              <span class="adv_gdr">{{t|capitalize }}
              </span>
              {%endfor%}       
            </div>
            </div>
            
          <div class="frm_wrap">
            <div class="adv_srch_hd">Categories</div>           
             <span id="all_category" style="display:none;">
            {% for c in category %}
            <input type="checkbox" name="category" id="category" value="{{c.id}}">{{c.name}}
            {%endfor%}        
             </span>
            <div class="frm_ele" id="category_empty">
           {% for c in category %}
            <span class="adv_radio" id="category_empty_span">
             <input type="checkbox" name="category_select" id="category_select" value="{{c.id}}">
             </span>
              <span class="adv_gdr" id="category_empty_label">
                  {{c.name}}</span>
              {%endfor%}  
                    
            </div>
           </div>
            
          <button type="button" class="btn btn-danger" data-toggle="collapse" data-target="#demo" onclick="SearchForm()">
        Search Product
        </button>
        </div> <!--End Main wrap --> 
    </div>
    
    
    
     <div class="clearfix"></div> 
     
    <div class="bs-docs-grid" id="all_data">              

        <div class="row-fluid show-grid product_main">
            <div class="span1 hds"><a href="{{  path('admin_products')~'/'~ 1~'/'~'id' }}" style=" text-decoration: none;"> ID</a></div>
            <div class="span1 hds"><a href="{{  path('admin_products')~'/'~ 1~'/'~'brand' }}">Brand</a></div>
            <div class="span1 hds"><a href="{{  path('admin_products')~'/'~ 1~'/'~'clothing_type' }}">Type</a></div>
            <div class="span1 hds"><a href="{{  path('admin_products')~'/'~ 1~'/'~'gender' }}" style=" text-decoration: none;">Gender</a></div>
            <div class="span1 hds"><a href="{{  path('admin_products')~'/'~ 1~'/'~'name' }}" style=" text-decoration: none;">Name</a></div>                        
            <div class="span1 hds">Try Count</div>
            <div class="span1 hds"></div>  
            <div class="span1 hds"></div>  
            <div class="span1 hds">View - Edit - Delete</div>  
            
        </div>  

          {% for p in products %}

        <div class="row-fluid show-grid product_main">
            <div class="span1">{{p.Id}}</div>
            <div class="span1">{{p.Brand.Name}}</div>
            <div class="span1">{{p.ClothingType.Name}}</div>
            <div class="span1">{{p.Gender}}</div>
            <div class="span1">{{p.Name}}</div>
            <div class="span1">{{ p.getTryProductCount }}</div>            
            <div class="span1"> {%if(p.disabled==1)%} Disabled {%else%}  {%endif%}</div>
            <div class="span1">
                {%if(p.displayProductColor)%}                  
                  <img src="{{ asset(p.displayProductColor.WebPath) }}"/>        
                    {%endif%}  
            </div>
         <div class="span1">           
         <a href="{{ path('admin_product_detail_show', {'id': p.Id}) }}" title="Show {{p.Name}}"><i class="icon-eye-open"></i></a>
         <a href="{{ path('admin_product_detail_edit', {'id': p.Id}) }}" title="Edit {{p.Name}}"><i class="icon-edit"></i></a>
         <a href="#myModaldetail{{p.Id}}" title="Delete {{p.Name}}" role="button" data-toggle="modal"><i class="icon-remove"></i></a>
         <a href="{{ path('admin_product_detail_download', {'id': p.Id}) }}" title="Download">Download </i></a>
         </div>
         
        </div>
   
 <!-- ModalDetail -->
<div id="myModaldetail{{p.Id}}" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
    <h3 id="myModalLabel">Delete Product</h3>
  </div>
  <div class="modal-body">
      <p>Are you sure you want to Delete this Product Detail <b>{{p.Name ~ ', ' ~ p.Brand.Name}}</b>?</p>
  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
    <a href="{{ path('admin_product_detail_delete', {'id': p.Id}) }}"  class="btn btn-primary">Delete</a>
    
  </div>
</div>        


{% endfor %}

 </div>
     
      <div class="bs-docs-grid" id="all_data_search"> 
          <div class="pagination"></div>
       </div>

    </div>
  <div id="pagination">
 {% include 'LoveThatFitAdminBundle::_pagination.html.twig'
  with {'rec_count':rec_count,'limit':limit,'per_page_limit':per_page_limit,'no_of_pagination':no_of_pagination
,'controller_name':'admin_products','sort':sort}
 %}        
 </div>      
   
</div>
 {% endblock %}
