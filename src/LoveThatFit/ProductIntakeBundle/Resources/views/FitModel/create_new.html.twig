{% extends 'LoveThatFitProductIntakeBundle::base.html.twig' %}
{% block body %}
    <style>
        .form-group.required .control-label:after {
            content:"*";
            color:red;
          }
          .spn_product_search{
            display: none;
        }
          
    </style>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
    size_specs=jQuery.parseJSON( $('#size_specs_json').text());
    product_specs = jQuery.parseJSON( $('#product_specs_json').text());
     //#################################################
        $('#csv_file').on('change', function(){     
            var val = $(this).val();
             if(val.substring(val.lastIndexOf('.') + 1).toLowerCase()=='csv'){
                 $("#uploading_image").html('<img src="{{ asset('bundles/lovethatfit/admin/images/loader.gif') }}" alt="Uploading...."/>');                

                var formData = new FormData();
                formData.append('csv_file', $('input[type=file]')[0].files[0]); 
                $.ajax({
                    url: '../specs_mapping/csv_extract',
                    data: formData,
                    type: 'POST',
                    contentType: false,
                    processData: false,
                    success: function (response) { 
                      
                        
                      $("#csv_file_json").text(response);
                      $("#uploading_image").html('');                
                      data = JSON.parse(response);
                      $.each(data,function(index, value){                        
                        $("#"+index).val(value);
                    });
                    }
                });

            }else{
                 alert("Invalid file");
                }          
        });    
    //---------------------------------------
    
     $( "#sel_gender" ).change(function() {
        fil_size();
});
   //---------------------------------------
   $( "#sel_size_type" ).change(function() {
        fil_size();
});
   //---------------------------------------
    
    function fill_clothing_type_list(gender){        
        gender=gender=='m'?'man':'women';             
        $('#sel_clothing_type').empty();
        var option = '<option value="">Select </option>';
        $.each(product_specs[gender].clothing_type, function(val, text) {
            option += '<option value="'+ val + '">' + text + '</option>';
                });
         $('#sel_clothing_type').append(option);         
    }
    //---------------------------------------
    function sel_size_type(gender){
        gender=gender=='m'?'man':'woman';        
        $('#sel_size_type').empty();
        var option = '<option value="">Select Size</option>';
        $.each(size_specs.size_title_type[gender], function(val, text) {
            option += '<option value="'+ val + '">' + text + '</option>';
                });
         $('#sel_size_type').append(option);         
    }
    //---------------------------------------
    function fil_size(){
            
        gender=$('#sel_gender').val()=='m'?'man':'woman';        
        $('#sel_size').empty();        
        var option = '<option value="">Select Size</option>';
        $.each(size_specs.sizes[gender][$('#sel_size_type').val()], function(val, text) {
            option += '<option value="'+ val + '">' + text + '</option>';
                });
         $('#sel_size').append(option);         
    }
    
        $(".add_size").click(function () {
            var fit_model_genrate = $('.fit_modele_genrate');
            var new_fit_model = $('#new_fit_model').val();            
            fit_model_genrate.append("<div class='form-group'> <label class='control-label col-sm-2'>"+new_fit_model+": </label>  <div class='col-sm-4'>  <input type='text' id="+new_fit_model+" name="+new_fit_model+">  </div>  </div>")
        });
        //-------------------------------------------------------------------
        
         $("#btn_toggle_product_search").click(function (event) {        
        event.preventDefault();
        $( ".spn_product_search" ).toggle();       
         $(this).text(function(i, text){
          return text === 'Hide Search'?'Show Search':'Hide Search';
      })        
    });
        //-------------------------------------------------------------------
        $("#btn_specs_search").click(function (event) {        
    event.preventDefault();
        id = $("#txt_search_id").val();    
        var fetch_url = "../product_specs/fetch_json/" + id+"/fit_model";
        $.ajax({
            url: fetch_url
            , success: function (response) {
                $("#product_specs_json").text(response);
                fill_size_list();
            }
        });        
    });
        //-------------------------------------------------------------------
        
        function fill_size_list(){
        obj=jQuery.parseJSON($("#product_specs_json").text());      
        $("#spn_product_name").text(obj.style_name);      
        document.getElementById("sel_product_size").options.length = 0;
        $("#sel_product_size").append(new Option('size',''));
        
        $.each( obj.sizes, function( key, value ) {
           $("#sel_product_size").append(new Option(key, key));
        });
   }
        //-------------------------------------------------------------------
        $('#sel_product_size').on('change', function (event) {            
            data=jQuery.parseJSON($("#product_specs_json").text());           
            $.each(data['sizes'][this.value],function(index, value){                        
                              $("#"+index).val(value);
                          });     
        });
});
    </script>   
<span id='size_specs_json' hidden="true">{{size_specs_json}}</span>
<span id='product_specs_json' hidden="true">{{product_specs_json}}</span>
<div style='display:none' id="csv_file_json"></div>
        
<div class="container">
        
<div class="row spn_product_search">
  <div class="col-md-8"></div>
  <div class="col-md-1 form-group">Specification Id</div>
  <div class="col-md-1 form-group"><input type="text" class="form-control" id="txt_search_id" placeholder="Id"></div>
  <div class="col-md-1 form-group"><button type="Button" id="btn_specs_search" class="btn btn-default">Extract</button></div>
</div>
<div class="row spn_product_search">
  <div class="col-md-8"></div>
  <div class="col-md-1 form-group"><span id="spn_product_name"> Select</span></div>
  <div class="col-md-1 form-group"><select id="sel_product_size" class="form-control" required></select></div>
</div>    
    
 <div class="row" style="display:none">
  <div class="col-md-1"></div>
  <div class="col-md-2 form-group">Select File</div>
  <div class="col-md-2 form-group"><input type="file" name="csv_file" id="csv_file"></div>
</div>       
        
        
        <h2>Fit Model Measurements</h2>
        <div class="btn-group" role="group" aria-label="..." style="float:right;">
            <a href="#" id="btn_toggle_product_search" class="btn btn-default">Show Search</a>           
            <a href="{{ path('product_intake_fit_model_index') }}" class="btn btn-default">List</a>           
        </div>
        
              
        <form action="{{ path('product_intake_fit_model_save')}}" method="post" class="form-horizontal"  >
            
            <br>
            
            <br>
            <div class="form-group required">
                <label class="control-label col-sm-2" for=""> Brand </label>
                <div class="col-sm-4">

                    <select name="sel_brand" id="sel_brand" class="sel_brand form-control" required="required">
                        <option value="">Select Brand</option>
                        {% for k, v in brands %}
                        <option value="{{ v.name }}"> {{ v.name }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <br>
            <div class="form-group required">
                <label class="control-label col-sm-2" for=""> Gender: </label>
                <div class="col-sm-4">
                    <select name="sel_gender" id="sel_gender" class="sel_gender form-control" required="required">
                        <option value="">Select Gender</option>               
                        <option value="m"> man</option>
                        <option value="f"> woman</option>               
                    </select>
                </div>
            </div>
            <br>
            <div class="form-group required">
                <label class="control-label col-sm-2" for=""> Size Title Type: </label>
                <div class="col-sm-4">
                    <select name="sel_size_type" id="sel_size_type" class="sel_size_type form-control" required="required">
                        <option value="">Size</option>               
                        <option value="number"> number</option>
                        <option value="letter"> letter</option>
                        <option value="waist"> waist</option>
                        <option value="chest"> chest</option>
                        <option value="bra"> bra</option>
                        <option value="shirt"> shirt</option>
                        <option value="neck"> neck</option>
                    </select>
                </div>
            </div>
              <br>
            <div class="form-group required">
                <label class="control-label col-sm-2" for=""> Size: </label>
                <div class="col-sm-4">
                    <select name="sel_size" id="sel_size" class="sel_size form-control" required="required">
                        <option value="">Size</option>                                       
                    </select>
                </div>
            </div>
            <br>
            <div class="form-group">
                <label class="control-label col-sm-2" for=""> Clothing Type: </label>
                <div class="col-sm-4">
                    <select name="sel_clothing_type" id="sel_clothing_type" class="sel_clothing_type form-control">
                        <option>Clothing Type</option>               
                        <option value="blouse" > Blouse </option>
                        <option value="tunic"> Tunic </option>
                        <option value="tee_knit"> Tee knit </option>
                        <option value="tank_knit"> Tank knit </option>
                        <option value="jacket"> Jacket </option>
                        <option value="sweater"> Sweater </option>
                        <option value="trouser"> Trouser </option>
                        <option value="jean"> Jean </option>
                        <option value="skirt"> Skirt </option>
                        <option value="dress"> Dress </option>
                        <option value="coat"> Coat </option>
                        <option value="shirt"> Shirt </option>
                        <option value="casual_jacket"> Casual Jacket </option>
                        <option value="sport_jacket"> Sport Jacket </option>
                        <option value="dress_jacket">  Dress Jacket </option>
                    </select>
                </div>
            </div>
          
            <br>
            <div class="form-group required">
                <label class="control-label col-sm-2" for="title">Text title : </label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" id="txt_title" name="txt_title" placeholder="Enter Title" required>
                </div>
            </div>
            <br>
        {% for k, v in fit_points %}             
            <div class="form-group {{  (k in required_fields)? 'required' : '' }} ">
                <label class="control-label col-sm-2" for="{{k}}">{{v}}  </label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" {{  (k in required_fields)? 'required' : '' }}  id="{{k}}" name="{{k}}" placeholder="Enter {{v}}" value="">                        
                    <span id="{{k}}_fm" name="{{k}}_fm"></span>
                    
                </div>
            </div>
            <br>            
        {% endfor %} 
        <div class="fit_modele_genrate">
        </div>
            <div class="form-group">  
                  <label class="control-label col-sm-2" for="title">Enter Fit Point : </label>              
                <div class="col-sm-4">
                    <input type="text" id="new_fit_model" name="fit_model"
                           maxlength="255">
                    <button type="button" class="add_size">Add Fit point </button>
                </div>
            </div>

            <div class="form-group">        
                <div class="col-sm-offset-5 col-sm-10">
                    <button type="submit" class="btn btn-default">Save</button>
                </div>
            </div>
        </form>
    </div>

{% endblock %}
