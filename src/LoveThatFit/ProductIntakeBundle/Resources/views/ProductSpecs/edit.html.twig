{% extends 'LoveThatFitProductIntakeBundle::base.html.twig' %}
{% block body %}

<script>
    var fit_array=[];
    var fabric_array = [];
    var garment_array = [];   
    var fit_values = [];
    var fit_priority_array_key = [];
    var garment_detail_array_key = [];
    var fabric_content_array_key = [];
    var input_value  = [];
   
    $(document).ready(function(){ 
      
       
           //-------------------------- Fit Model Validation Sizes Dimention
           $("tr#validation_fit_model").on('click', function() {
             //event.preventDefault();  
              input_value = [];
                row_class = $(this).attr('class');
                $("."+row_class).closest('tr').find("input").each(function() {
                  input_value.push($(this).val());              
                });              
            });
            console.log(input_value);
            
                //        var text = '';
           $("table tr td input").on('keyup', function(e) {  
               if ((e.keyCode >= 48 && e.keyCode <= 57) || (e.keyCode >= 96 && e.keyCode <= 105)) { 
                    input_val = $.trim(this.value);
                    val_index = ($(this).parent().index())-1;
                    //alert(input_value[5])
                    if(input_val > input_value[5] && val_index == 0 || input_val > input_value[5] && val_index == 2 || input_val > input_value[5] && val_index == 3 || input_val > input_value[5] && val_index == 4){
                        alert("Ops! Must be value less then Fit Model");
                    } 
                     if(input_val < input_value[5] && val_index == 6 || input_val < input_value[5] && val_index == 7 || input_val < input_value[5] && val_index == 8 || input_val < input_value[5] && val_index == 9){
                       alert("Ops! Must be value greater then Fit Model");
                     }
                }
              // input_value = [];
            });
          
      
      //---------------- Fit Model Calcultion on Ajax Hit
        $(".fit_model_size").change(function() {
            var pro_speci_id = $('.product_spec_size').val();            
            fit_model_id = this.value;
                $.ajax({
                    type: "POST",
                    url: "../measurements_with_fitmodel",
                    data: {fit_model_measurement_id:fit_model_id,product_specification_id: pro_speci_id},
                    dataType: "json",
                    success: function (response) {    
                        $('#dv_measurement_table').empty();
                        var tableData = '<table class="table table-bordered">';
                        $.each(response, function (size_label, size_measurements) { 
                            tableData+="<tr class='Active'><th >"+size_label+"</th><th >garment_dimension</th><th >garment_stretch</th><th >min_calc</th><th >min_actual</th><th >ideal_low</th><th >fit_model</th><th >ideal_high</th><th >max_calc</th> <th >max_actual</th><th >grade rule</th></tr>" 
                            $.each(size_measurements, function (size_measurements_label, size_measurements_dimention) {                               
                                tableData+= "<tr><th>"+size_measurements_label+"</th>" 
                                $.each(size_measurements_dimention, function (size_measurements_dimention_label, size_measurements_dimention_value) {                                   
                                      tableData+="<td><input type='number' value="+size_measurements_dimention_value+" name='sizes-"+size_label+"-"+size_measurements_label+"-"+size_measurements_dimention_label+"' style='width:50px'> </td>";
                                })
                                tableData+= "</tr>"; 
                            });                                     
                        });
                        tableData+= "</table>";
                        $('#dv_measurement_table').append(tableData); 
                    },
                    failure: function (errMsg) {
                      display_response(errMsg);
                      console.log(errMsg);
                    }
                });
             //alert(sizes)
            
             {#var tableData = '<table class="table table-bordered">';
             $.each(sizes, function (size_label, size_measurements) {
                    //tableData += "<th>" + size_label + "</th>";
                    console.log(size_label);
                  tableData+="<tr class='Active'><th >"+size_label+"</th><th >garment_dimension</th><th >garment_stretch</th><th >min_calc</th><th >min_actual</th><th >ideal_low</th><th >fit_model</th><th >ideal_high</th><th >max_calc</th> <th >max_actual</th><th >grade rule</th></tr>" 
                    $.each(size_measurements, function (size_measurements_label, size_measurements_dimention) {
                        console.log(size_measurements_label);
                        tableData+= "<tr><th>"+size_measurements_label+"</th>" 
                                          
                        $.each(size_measurements_dimention, function (size_measurements_dimention_label, size_measurements_dimention_value) {
                             console.log(size_measurements_dimention_label);
                              tableData+="<td><input type='text' value="+size_measurements_dimention_value+" name='sizes-"+size_label+"-"+size_measurements_dimention_label+"-garment_dimension' style='width:50px'> </td>";
                                         
                         })
                         tableData+= "</tr>"; 
                    });
                   // console.log(tableData);
                  
                });
                 tableData+= "</table>";
                   $('.size_calculate').append(tableData);#}
      
         //alert( $('option:selected', this).text() );
         
        });
        
       
        //-------------- Check Fit Priority Alredy Added
        $('.fit_point_selected').click(function () {               
            var fit_point_val = $.trim($('.fit_point option:selected').val());           
            $(".fit_priority > .singleField > input[type='number']").each(function() {                 
                  fit_priority_array_key.push($(this).attr('id'));
            });  
                 
            if($.inArray(fit_point_val, fit_array) != -1  || $.inArray(fit_point_val, fit_priority_array_key)!= -1  )
            {
                alert("Ops! Already Fit Priority "+ fit_point_val +" Added");    
            } else {
            fit_array.push(fit_point_val);
            var fit_priority = [];
            var fit_priority = "fit_priority["+fit_point_val+"]";                   
             $('.fit_priority').prepend(" <label>"+fit_point_val+":</label> <input type='number' min='1' max='100' name="+fit_priority+" style='width:50px'>%");
            }
        });
        //------------ Count Summ Equal to 100 Validation
        $('.fit_priority').keyup(function() {
            var sum=0;
            $(".fit_priority >  input[type='number']").each(function() {
               var value = +this.value || 0;
               sum += value;
            });
            $(".fit_priority > .singleField > input[type='number']").each(function() {
               var value = +this.value || 0;
               sum += value;
            });
            if(sum > 100){
                alert("ops! Your can't Enter sum of fit Priority grater then 100");
                $(".fit_priority > input[type='number']").focus(function() {
                     $(this).val("");
                });   
                $(".fit_priority .singleField > input[type='number']").focus(function() {
                     $(this).val("");
                }); 
            }           
        })  
        //--------------- Check Fabric Content Already Added
        $('.add_fabric_content').click(function () {                     
            var fabric_content_val = $.trim($('.fabric_content_value').val()); 
            $(".fabric_content > .singleField > input[type='number']").each(function() {                 
                fabric_content_array_key.push($(this).attr('id'));
            });      
            
            if( $.inArray(fabric_content_val, fabric_array) != -1 || $.inArray(fabric_content_val, fabric_content_array_key)!= -1 )
                {
                    alert("Ops! Already Fabric Content "+ fabric_content_val +" Added");    
                } else {
                    fabric_array.push(fabric_content_val);
                    var fabric_content = [];
                    var fabric_content = "fabric_content["+fabric_content_val+"]"; 
                    $('.fabric_content').prepend(" <label>"+fabric_content_val+":</label> <input type='number' min='1' max='100' name="+fabric_content+" style='width:50px'>%");
            }
        });
        
        //------------ Count Garment detail Sum Equal to 100 Validation
        $('.fabric_content').keyup(function() {
            var sum=0;
            $(".fabric_content > input[type='number']").each(function() {
               var value = +this.value || 0;
               sum += value;
            });
            $(".fabric_content > .singleField > input[type='number']").each(function() {
               var value = +this.value || 0;
               sum += value;
            });
            if(sum > 100){
                alert("ops! Your can't Enter sum of fabric content grater then 100");
                $(".fabric_content > input[type='number']").focus(function() {
                     $(this).val("");
                });   
                 $(".fabric_content > .singleField > input[type='number']").focus(function() {
                     $(this).val("");
                }); 
            }           
        })  
        
        //--------------- Check garment detail Already Added
        $('.add_garment_detail').click(function () {                     
            var garment_detail_val = $.trim($('.garment_detail_value').val());                
            $(".garment_detail > .singleField > input[type='number']").each(function() {                 
                garment_detail_array_key.push($(this).attr('id'));
            });              
            if( $.inArray(garment_detail_val, garment_array) != -1 || $.inArray(garment_detail_val, garment_detail_array_key)!= -1 )
                {
                   alert("Ops! Already garment detail "+ garment_detail_val +" Added");    
                } else {
                    garment_array.push(garment_detail_val);
                    var garment_detail = [];
                    var garment_detail = "garment_detail["+garment_detail_val+"]"; 
                   $('.garment_detail').prepend(" <label>"+garment_detail_val+":</label> <input type='number' min='1' max='100' name="+garment_detail+" style='width:50px'>%");
            }
        });
        //------------ Count Garment detail Sum Equal to 100 Validation
        $('.garment_detail').keyup(function() {
            var sum=0;
            $(".garment_detail > input[type='number']").each(function() {
               var value = +this.value || 0;
               sum += value;
            });
            $(".garment_detail > .singleField > input[type='number']").each(function() {
               var value = +this.value || 0;
               sum += value;
            });
            if(sum > 100){
                alert("ops! Your can't Enter sum of garment detail grater then 100");
                $(".garment_detail > input[type='number']").focus(function() {
                     $(this).val("");
                });   
                $(".garment_detail > .singleField > input[type='number']").focus(function() {
                     $(this).val("");
                });   
            }           
        })  
        
        $.fn.editable.defaults.mode = 'popup';     
        $('#username').editable();              

    });

</script>
    <style type="text/css">
    .tblData input[type="text"], .tblData select
    {
        width: 60%;
        height: 34px;
        padding: 6px 12px;
        font-size: 14px;
        line-height: 1.42857143;
        color: #555;
        background-color: #fff;
        background-image: none;
        border: 1px solid #ccc;
        border-radius: 4px;
        -webkit-box-shadow: inset 0 1px 1px rgba(0,0,0,.075);
        box-shadow: inset 0 1px 1px rgba(0,0,0,.075);
        -webkit-transition: border-color ease-in-out .15s,-webkit-box-shadow ease-in-out .15s;
        -o-transition: border-color ease-in-out .15s,box-shadow ease-in-out .15s;
        transition: border-color ease-in-out .15s,box-shadow ease-in-out .15s;
        margin:10px;
    }
    .hlist .singleField{ display:inline-block;} 
    .hlist .singleField label{
        float: left;
        position: relative;        
        margin-right: 5px;
    }
    
    </style>    
    <div class="btn-group" role="group" aria-label="..." style="float:right;">
        <a href="{{ path('product_intake_product_specs_show', {'id': app.request.get('id')}) }}" class="btn btn-default">preview</a> 
    </div>
    <span id='product_specs_json' hidden="true">{{product_specs_json}}</span>
       
   <form action="{{ path('product_intake_product_specs_update',{id: app.request.get('id')}) }}" method="post" enctype="multipart/form-data"  class="form-horizontal" >
       <div class="container">        
{#        <a href="#" id="username" data-type="text" data-placement="right" data-title="Enter username">superuser</a>#}
        <table class="tblData">
            <tr>
                <td>
                    <table>
                        {% for specs_k, specs_v in parsed_data %}
                           {% if (specs_k!='sizes') %}
                                {% if specs_k in drop_down_values|keys %}
                                    <tr>
                                        <td><span style="font-weight: bold ">{{specs_k}}</span>: &nbsp;</td>
                                        <td>
                                            <div class="hlist">
                                                  {% if specs_k == 'fabric_content' or specs_k == 'fit_priority'  or specs_k == 'garment_detail'%}
                                                    <div class="{{specs_k}}"> 
                                                        {% for key,val in parsed_data[specs_k] %}
                                                            <div class="singleField">
                                                               <label>
                                                                   {{ key }} : 
                                                               </label> 
                                                                   <input type="number" min="1" max="100" value="{{val}}" id="{{key}}"  name="{{ specs_k }}[{{key}}]" style="width:70px">
                                                            </div>
                                                        {% endfor %}
                                                    
                                                        {% if specs_k == 'fabric_content' %}
                                                          {#<label>
                                                                 Enter fabric Content : 
                                                               </label> #}
                                                          <input type="text" class="fabric_content_value"  min="1" max="100" value="" name="" style="width:70px; background-color: #cccccc"">
                                                          <input class="add_fabric_content" type="button" value="Add">
                                                        {% endif %} 
                                                     
                                                        {% if specs_k == 'garment_detail' %}
                                                          {#<label>
                                                                 Enter fabric Content : 
                                                               </label> #}
                                                          <input type="text" class="garment_detail_value" min="1" max="100" value="" name="" style="width:70px; background-color: #cccccc"">
                                                          <input class="add_garment_detail" type="button" value="Add">
                                                        {% endif %} 
                                                     
                                                       {% if specs_k == 'fit_priority' %}
                                                           <select name="" class="fit_point" style="width:auto; background-color: #cccccc" data-width="100%">   
                                                                {% for key,val in fit_points %}
                                                                   <option value="{{val}}"> {{key}}</option>
                                                                {% endfor %}
                                                            </select> 
                                                           <input class="fit_point_selected" type="button" value="Add">
                                                    </div>
                                                        {% endif %} 
                                                    {% else %}
                                                        <select name="{{ specs_k }}" class="{{ specs_k }}" data-width="100%">
                                                            <option  >Select</option>
                                                            {% for key,val in drop_down_values[specs_k] %}
                                                               <option value="{{ val }}"{{specs_v =='' and key == 0 ? 'selected':val==specs_v?'selected':'' }}   >{{ key }}</option>
                {#                                                <option value="{{ val.value }}" {{  form.country.vars.value == '' and key == 0 ? ' selected ' :(val.value == form.country.vars.value ? ' selected ' : '') }}>{{ val.label | trans }}</option>#}
                                                            {% endfor %}
                                                        </select>  
                                                       {# {% if specs_k == 'fit_model_size'%}
                                                            <a href="#" id="a_fit_model_size">Calculate</a> 
                                                        {% endif %}  #}                    
                                                    
                                                    {% endif %}                      
                                            </div>
                                        </td>
                                    </tr>
                                {% else %}                               
                                <tr>
                                    <td><span style="font-weight: bold ">{{specs_k}}</span>: &nbsp;</td>
                                    <td><span><input type="text"  class="form-control"  {{specs_k in disabled_fields?'readonly':''}} value="{{specs_v}}" name="{{specs_k}}"> </span></td>
                                </tr>
                            {% endif %}
                                
                            {% endif %}
                        {% endfor %}
                    </table>
                </td>
            </tr>
        </table>
<br>

{#---------------------------------------------------------------------------------------------#}
            <table>                
                <tr>
                    <td>
                        <div id="dv_measurement_table">
                            <table class="table table-bordered ">
                            {% for size, fit_point in parsed_data.sizes %}
                                    <tr class="Active">
                                        <th >{{size}}</th>
                                        <th >garment_dimension</th>
                                        <th >garment_stretch</th>
                                        <th >min_calc</th>
                                        <th >min_actual</th>
                                        <th >ideal_low</th>
                                        <th >fit_model</th>
                                        <th >ideal_high</th>
                                        <th >max_calc</th>
                                        <th >max_actual</th>
                                        <th >grade rule</th>
                                    </tr>
                                {% for measurement_k, measurement_v in fit_point %}
                                    {% if (measurement_v.garment_dimension>0) %}
                                        <tr class="{{ size }}_{{ measurement_k }}" id="validation_fit_model" >
                                            <th>{{measurement_k}}</th>
                                            <td><input type="number" value="{{measurement_v.garment_dimension | number_format(2, '.', '')}}" name="sizes-{{ size }}-{{ measurement_k }}-garment_dimension" style="width:50px"> </td>
                                            <td><input type="number" value="{{measurement_v.garment_stretch | number_format(2, '.', '')}}" name="sizes-{{ size }}-{{ measurement_k }}-garment_stretch" style="width:50px"></td>
                                            <td><input type="number" value="{{measurement_v.min_calc | number_format(2, '.', '')}}" name="sizes-{{ size }}-{{ measurement_k }}-min_calc" style="width:50px"></td>
                                            <td><input type="number" value="{{measurement_v.min_actual | number_format(2, '.', '')}}" name="sizes-{{ size }}-{{ measurement_k }}-min_actual" style="width:50px"></td>
                                            <td><input type="number" value="{{measurement_v.ideal_low | number_format(2, '.', '')}}" name="sizes-{{ size }}-{{ measurement_k }}-ideal_low" style="width:50px"></td>
                                            <td><input type="number" value="{{measurement_v.fit_model | number_format(2, '.', '')}}" name="sizes-{{ size }}-{{ measurement_k }}-fit_model" style="width:50px"></td>
                                            <td><input type="number" value="{{measurement_v.ideal_high | number_format(2, '.', '')}}" name="sizes-{{ size }}-{{ measurement_k }}-ideal_high" style="width:50px"></td>
                                            <td><input type="number" value="{{measurement_v.max_calc | number_format(2, '.', '')}}" name="sizes-{{ size }}-{{ measurement_k }}-max_calc" style="width:50px"></td>
                                            <td><input type="number" value="{{measurement_v.max_actual | number_format(2, '.', '')}}" name="sizes-{{ size }}-{{ measurement_k }}-max_actual" style="width:50px"></td>
                                            <td><input type="number" value="{{measurement_v.grade_rule | number_format(2, '.', '')}}" name="sizes-{{ size }}-{{ measurement_k }}-grade rule" style="width:50px"></td>
                                        </tr>
                                    {% endif %}
                                {% endfor %}
                            {% endfor %}
                                </table>
                            </div>
                        </td>
                    </tr>
                </table>
            <input type="submit" value="Save">                              
    </div>
</form>                                
  <br>                
  <input type="hidden" class="product_spec_size" value="{{ app.request.get('id') }} ">

  
{% endblock %}
